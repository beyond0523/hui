<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"><title></title><link href="../css/mui.min.css" rel="stylesheet"><link rel="stylesheet" href="../css/app.css"><link href="../css/mui.imageviewer.css" rel="stylesheet"><style>body,html{height:100%;margin:0;padding:0;overflow:hidden;-webkit-touch-callout:none;-webkit-user-select:none}footer{position:fixed;width:100%;height:50px;min-height:50px;border-top:solid 1px #bbb;left:0;bottom:0;overflow:hidden;padding:0 50px;background-color:#fafafa}.footer-left{position:absolute;width:50px;height:50px;left:0;bottom:0;text-align:center;vertical-align:middle;line-height:100%;padding:12px 4px}.footer-right{position:absolute;width:50px;height:50px;right:0;bottom:0;text-align:center;vertical-align:middle;line-height:100%;padding:12px 5px;display:inline-block}.footer-center{height:100%;padding:5px 0}.footer-center [class*=input]{width:100%;height:100%;border-radius:5px}.footer-center .input-text{background:#fff;border:solid 1px #ddd;padding:10px!important;font-size:16px!important;line-height:18px!important;font-family:verdana!important;overflow:hidden}.footer-center .input-sound{background-color:#eee}.mui-content{height:100%;padding:44px 0 50px 0;overflow:auto;background-color:#eaeaea}#msg-list{height:100%;overflow:auto;-webkit-overflow-scrolling:touch}.msg-item{padding:8px;clear:both}.msg-item .mui-item-clear{clear:both}.msg-item .msg-user{width:38px;height:38px;border:solid 1px #d3d3d3;display:inline-block;background:#fff;border-radius:3px;vertical-align:top;text-align:center;float:left;padding:3px;color:#ddd}.msg-item .msg-user-img{width:38px;height:38px;display:inline-block;border-radius:3px;vertical-align:top;text-align:center;float:left;color:#ddd}.msg-item .msg-content{display:inline-block;border-radius:5px;border:solid 1px #d3d3d3;background-color:#fff;color:#333;padding:8px;vertical-align:top;font-size:15px;position:relative;margin:0 8px;max-width:75%;min-width:35px;float:left}.msg-item .msg-content .msg-content-inner{overflow-x:hidden}.msg-item .msg-content .msg-content-arrow{position:absolute;border:solid 1px #d3d3d3;border-right:none;border-top:none;background-color:#fff;width:10px;height:10px;left:-5px;top:12px;-webkit-transform:rotateZ(45deg);transform:rotateZ(45deg)}.msg-item-self .msg-content,.msg-item-self .msg-user{float:right}.msg-item-self .msg-content .msg-content-arrow{left:auto;right:-5px;-webkit-transform:rotateZ(225deg);transform:rotateZ(225deg)}.msg-item-self .msg-content,.msg-item-self .msg-content .msg-content-arrow{background-color:#4cd964;color:#fff;border-color:#2ac845}footer .mui-icon{color:#000}footer .mui-icon:active{color:#007aff!important}footer .mui-icon-paperplane:before{content:"发送"}footer .mui-icon-paperplane{font-size:16px;word-break:keep-all;line-height:100%;padding-top:6px;color:rgba(0,135,250,1)}#msg-sound{-webkit-user-select:none!important;user-select:none!important}.rprogress{position:absolute;left:50%;top:50%;width:140px;height:140px;margin-left:-70px;margin-top:-70px;background-image:url(../img/arecord.png);background-repeat:no-repeat;background-position:center center;background-size:30px 30px;background-color:rgba(0,0,0,.7);border-radius:5px;display:none;-webkit-transition:.15s}.rschedule{background-color:rgba(0,0,0,0);border:5px solid rgba(0,183,229,.9);opacity:.9;border-left:5px solid transparent;border-right:5px solid transparent;border-radius:50px;box-shadow:0 0 15px #2187e7;width:46px;height:46px;position:absolute;left:50%;top:50%;margin-left:-23px;margin-top:-23px;-webkit-animation:spin 1s infinite linear;animation:spin 1s infinite linear}.r-sigh{display:none;border-radius:50px;box-shadow:0 0 15px #2187e7;width:46px;height:46px;position:absolute;left:50%;top:50%;margin-left:-23px;margin-top:-23px;text-align:center;line-height:46px;font-size:40px;font-weight:700;color:#2187e7}.rprogress-sigh{background-image:none!important}.rprogress-sigh .rschedule{display:none!important}.rprogress-sigh .r-sigh{display:block!important}.rsalert{font-size:12px;color:#bbb;text-align:center;position:absolute;border-radius:5px;width:130px;margin:5px 5px;padding:5px;left:0;bottom:0}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0)}100%{-webkit-transform:rotate(360deg)}}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}#h{background:#fff;border:solid 1px #ddd;padding:10px!important;font-size:16px!important;font-family:verdana!important;line-height:18px!important;overflow:visible;position:absolute;left:-1000px;right:0;word-break:break-all;word-wrap:break-word}.cancel{background-color:#8b0000}</style></head><body contextmenu="return false;"><header class="mui-bar mui-bar-nav"><a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a><h1 class="mui-title">chat (聊天窗口)</h1></header><pre id="h"></pre><script id="msg-template" type="text/template"> <% for(var i in record){ var item=record[i]; %> <div class="msg-item <%= (item.sender=='self'?' msg-item-self':'') %>" msg-type='<%=(item.type)%>' msg-content='<%=(item.content)%>'> <% if(item.sender=='self' ) { %> <i class="msg-user mui-icon mui-icon-person"></i> <% } else { %> <img class="msg-user-img" src="../img/logo.png" alt="" /> <% } %> <div class="msg-content">
						<div class="msg-content-inner"> <% if(item.type=='text' ) { %> <%=( item.content|| '&nbsp;&nbsp;') %> <% } else if(item.type=='image' ) { %> <img class="msg-content-image" src="<%=(item.content)%>" style="max-width: 100px;" /> <% } else if(item.type=='sound' ) { %> <span class="mui-icon mui-icon-mic" style="font-size: 18px;font-weight: bold;"></span>
								<span class="play-state">点击播放</span> <% } %> </div>
						<div class="msg-content-arrow"></div>
					</div>
					<div class="mui-item-clear"></div>
				</div> <% } %> </script><div class="mui-content"><div id="msg-list"></div></div><footer><div class="footer-left"><i id="msg-image" class="mui-icon mui-icon-camera" style="font-size:28px"></i></div><div class="footer-center"><textarea id="msg-text" type="text" class="input-text"></textarea><button id="msg-sound" type="button" class="input-sound" style="display:none">按住说话</button></div><label for="" class="footer-right"><i id="msg-type" class="mui-icon mui-icon-mic"></i></label></footer><div id="sound-alert" class="rprogress"><div class="rschedule"></div><div class="r-sigh">!</div><div id="audio_tips" class="rsalert">手指上滑，取消发送</div></div><script src="../js/mui.min.js"></script><script src="../js/mui.imageViewer.js"></script><script src="../js/arttmpl.js"></script><script charset="utf-8">!function(e,t){var n=800;e.init({gestureConfig:{tap:!0,doubletap:!0,longtap:!0,swipe:!0,drag:!0,hold:!0,release:!0}}),template.config("escape",!1),e.plusReady(function(){function s(){i.boxMsgText.focus(),setTimeout(function(){i.boxMsgText.focus()},150)}plus.webview.currentWebview().setStyle({softinputMode:"adjustResize"});var o=[{sender:"zs",type:"text",content:"Hi，我是 H 小管家！"}],i={body:t.querySelector("body"),footer:t.querySelector("footer"),footerRight:t.querySelector(".footer-right"),footerLeft:t.querySelector(".footer-left"),btnMsgType:t.querySelector("#msg-type"),boxMsgText:t.querySelector("#msg-text"),boxMsgSound:t.querySelector("#msg-sound"),btnMsgImage:t.querySelector("#msg-image"),areaMsgList:t.querySelector("#msg-list"),boxSoundAlert:t.querySelector("#sound-alert"),h:t.querySelector("#h"),content:t.querySelector(".mui-content")};i.h.style.width=i.boxMsgText.offsetWidth+"px";var a=i.footer.offsetHeight-i.boxMsgText.offsetHeight,c=function(e,t){var n=e.getAttribute("msg-type"),s=e.getAttribute("msg-content");if("sound"==n){player=plus.audio.createPlayer(s);var o=e.querySelector(".play-state");o.innerText="正在播放...",player.play(function(){o.innerText="点击播放"},function(e){o.innerText="点击播放"})}},r=new e.ImageViewer(".msg-content-image",{dbl:!1}),l=function(){i.areaMsgList.innerHTML=template("msg-template",{record:o});var e=i.areaMsgList.querySelectorAll(".msg-item");[].forEach.call(e,function(e,t){e.addEventListener("tap",function(t){c(e,t)},!1)}),r.findAllImage(),i.areaMsgList.scrollTop=i.areaMsgList.scrollHeight+i.areaMsgList.offsetHeight};l(),window.addEventListener("resize",function(){i.areaMsgList.scrollTop=i.areaMsgList.scrollHeight+i.areaMsgList.offsetHeight},!1);var u=function(e){o.push(e),l(),g(e.content)},g=function(t){var n="http://www.tuling123.com/openapi/api";e.getJSON(n,{key:"acfbca724ea1b5db96d2eef88ce677dc",info:t,userid:plus.device.uuid},function(e){o.push({sender:"zs",type:"text",content:e.text}),l()})};i.footerRight.addEventListener("touchstart",function(e){i.btnMsgType.classList.contains("mui-icon-paperplane")&&(s(),e.preventDefault())}),i.footerRight.addEventListener("touchmove",function(e){i.btnMsgType.classList.contains("mui-icon-paperplane")&&(s(),e.preventDefault())}),i.footerRight.addEventListener("release",function(t){i.btnMsgType.classList.contains("mui-icon-paperplane")?(i.boxMsgText.focus(),setTimeout(function(){i.boxMsgText.focus()},150),u({sender:"self",type:"text",content:i.boxMsgText.value.replace(new RegExp("\n","gm"),"<br/>")}),i.boxMsgText.value="",e.trigger(i.boxMsgText,"input",null)):i.btnMsgType.classList.contains("mui-icon-mic")?(i.btnMsgType.classList.add("mui-icon-compose"),i.btnMsgType.classList.remove("mui-icon-mic"),i.boxMsgText.style.display="none",i.boxMsgSound.style.display="block",i.boxMsgText.blur(),document.body.focus()):i.btnMsgType.classList.contains("mui-icon-compose")&&(i.btnMsgType.classList.add("mui-icon-mic"),i.btnMsgType.classList.remove("mui-icon-compose"),i.boxMsgSound.style.display="none",i.boxMsgText.style.display="block",i.boxMsgText.focus(),setTimeout(function(){i.boxMsgText.focus()},150))},!1),i.footerLeft.addEventListener("tap",function(e){var t=[{title:"拍照"},{title:"从相册选择"}];plus.nativeUI.actionSheet({title:"选择照片",cancel:"取消",buttons:t},function(e){var t=e.index;switch(t){case 0:break;case 1:var n=plus.camera.getCamera();n.captureImage(function(e){u({sender:"self",type:"image",content:"file://"+plus.io.convertLocalFileSystemURL(e)})},function(e){});break;case 2:plus.gallery.pick(function(e){u({sender:"self",type:"image",content:e})},function(e){},null)}})},!1);var d=function(e){e?(i.boxSoundAlert.style.display="block",i.boxSoundAlert.style.opacity=1):(i.boxSoundAlert.style.opacity=0,setTimeout(function(){i.boxSoundAlert.style.display="none"},200))},p=!1,f=null,x=document.getElementById("audio_tips"),b=null,m=null,y=null;i.boxMsgSound.addEventListener("hold",function(e){return p=!1,y&&clearTimeout(y),x.innerHTML="手指上划，取消发送",i.boxSoundAlert.classList.remove("rprogress-sigh"),d(!0),f=plus.audio.getRecorder(),null==f?void plus.nativeUI.toast("不能获取录音对象"):(b=(new Date).getTime(),void f.record({filename:"_doc/audio/"},function(e){p||u({sender:"self",type:"sound",content:e})},function(e){plus.nativeUI.toast("录音时出现异常: "+e.message)}))},!1),i.body.addEventListener("drag",function(e){Math.abs(e.detail.deltaY)>50?p||(p=!0,x.classList.contains("cancel")||x.classList.add("cancel"),x.innerHTML="松开手指，取消发送"):p&&(p=!1,x.classList.contains("cancel")&&x.classList.remove("cancel"),x.innerHTML="手指上划，取消发送")},!1),i.boxMsgSound.addEventListener("release",function(e){x.classList.contains("cancel")&&(x.classList.remove("cancel"),x.innerHTML="手指上划，取消发送"),m=(new Date).getTime(),m-b<n?(x.innerHTML="录音时间太短",i.boxSoundAlert.classList.add("rprogress-sigh"),p=!0,y=setTimeout(function(){d(!1)},800)):d(!1),f.stop()},!1),i.boxMsgSound.addEventListener("touchstart",function(e){e.preventDefault()}),i.boxMsgText.addEventListener("input",function(e){i.btnMsgType.classList[""==i.boxMsgText.value?"remove":"add"]("mui-icon-paperplane"),i.btnMsgType.setAttribute("for",""==i.boxMsgText.value?"":"msg-text"),i.h.innerText=i.boxMsgText.value.replace(new RegExp("\n","gm"),"\n-")||"-",i.footer.style.height=i.h.offsetHeight+a+"px",i.content.style.paddingBottom=i.footer.style.height});var M=!1;i.boxMsgText.addEventListener("tap",function(e){i.boxMsgText.focus(),setTimeout(function(){i.boxMsgText.focus()},0),M=!0,setTimeout(function(){M=!1},1e3),e.detail.gesture.preventDefault()},!1),i.areaMsgList.addEventListener("click",function(e){M||i.boxMsgText.blur()})})}(mui,document)</script></body></html>